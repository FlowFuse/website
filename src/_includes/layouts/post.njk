---js
{
    layout: "layouts/base.njk",
    type: "post",
    eleventyComputed: {
        permalink: data => isFuturePost(data) ? false : `${data.page.filePathStem}/`,
        eleventyExcludeFromCollections: data => isFuturePost(data)
    },
    hubspot: {
        script: "hubspot/hs-form.njk",
        formId: "159c173d-dd95-49bd-922b-ff3ef243e90c",
        cta: "cta-blog-subscribe",
        reference: "article"
    }
}
---
{% if date | isFutureDate %}
    <div class="w-full page post bg-indigo-600 text-center text-white py-4 font-bold">
    This post is scheduled to be published on {{ date | shortDate }}
    </div>
{% endif %}

<div class="w-full page post">
    {% if title %}
        <div class="post-title container m-auto text-center max-lg:px-6 flex mt-6 mb-6 md:max-w-screen-lg md:mt-12">
            <div class="text-left md:pr-32">
                <label>Article</label>
                <h1>{{ title }}</h1>
                {% if subtitle %}
                    <h4>{{ subtitle | safe }}</h4>
                {% endif %}
                {%- if lastUpdated -%}
                  <p class="text-sm text-gray-400 font-normal mb-1">
                    This post was last updated on <time value="{{ lastUpdated | dateToRfc3339 }}">{{ lastUpdated | shortDate }}</time>
                  </p>
                {%- endif -%}
            </div>
        </div>
    {% endif %}
    <div class="blog nohero w-full pb-24">
        <div class="container flex flex-col md:flex-row m-auto text-left max-lg:px-6 md:max-w-screen-lg gap-8 items-stretch">
            <div class="ff-prose">
                <a class="inline-flex align-center gap-1 mb-4" href="/blog">
                    {% include "components/icons/chevron-left.svg" %}
                    Back to Blog Posts
                </a>
                <div class="prose w-full flex-grow">
                    <div class="mb-4 hero-img">
                        {% if video %}
                            <iframe width="560" height="315" src="https://www.youtube.com/embed/{{video}}"
                            title="YouTube video player" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen></iframe>
                        {% else %}
                            <div class="w-full h-auto">
                                {% tileImage null, image, "./images/og-blog.jpg", "Image with logo and the slogan: Elevate Node-RED with Flowfuse", 560 %}
                            </div>
                        {% endif %}
                    </div>
                    {{ content | safe }}
                </div>
                {% if meta.faq %}
                    <div class="prose mt-12">
                        <h2 class="mb-1">Frequently Asked Questions</h2>
                        {% include "faq.njk" %}
                    </div>
                {% endif %}
                
                <!-- Related Articles Section -->
                {%- set postsToShow = collections.posts | relatedPosts -%}
                {%- if postsToShow.length == 0 %}
                    {%- set postsToShow = collections.posts | reverse | limit(9) -%}
                {%- endif %}
                
                {%- set filteredPosts = [] -%}
                {%- for post in postsToShow %}
                    {% if post.data.title != title %}
                        {%- set filteredPosts = (filteredPosts.push(post), filteredPosts) -%}
                    {% endif %}
                {%- endfor %}
                
                {% if filteredPosts.length > 0 %}
                <div class="related-articles mt-16 pt-8 border-t-2">
                    <h3 class="mb-6">Read Next:</h3>
                    <div class="relative">
                        <div class="related-articles-slider overflow-hidden">
                            <div class="related-articles-track flex transition-transform duration-500 ease-in-out">
                                {%- for post in filteredPosts %}
                                        <div class="related-article-item flex-none w-full md:w-1/3 px-2">
                                            <a href="{{ post.url }}" class="block group hover:no-underline">
                                                <div class="ff-blog-tile mb-3">
                                                    <div class="w-full h-auto">
                                                        {% tileImage post, post.data.image, "./images/og-blog.jpg", "Related article image", 285 %}
                                                    </div>
                                                </div>
                                                <h3 class="text-lg font-medium group-hover:underline line-clamp-2">{{ post.data.title }}</h3>
                                                <time class="text-xs text-gray-500" value="{{ post.date }}">{{ post.date | shortDate }}</time>
                                            </a>
                                        </div>
                                {%- endfor %}
                            </div>
                        </div>
                        <!-- Navigation buttons -->
                        <button class="related-articles-prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 bg-white shadow-lg rounded-full p-2 hover:bg-gray-100 transition-colors z-10" aria-label="Previous articles">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <button class="related-articles-next absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 bg-white shadow-lg rounded-full p-2 hover:bg-gray-100 transition-colors z-10" aria-label="Next articles">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="w-72 max-w-full flex-shrink-0">
                <div class="mt-6 flex flex-col">
                    {% include "layouts/toc.njk" %}
                </div>
                <div class="sticky top-20">
                    <h3 class="mb-3">Written By:</h3>
                    {% for author in authors %}
                        {% renderTeamMember people[author] %}
                    {% endfor %}
                    <p>Published on: <time value="{{ date | dateToRfc3339 }}">{{ date | shortDate }}</time>
                    </p>
                    <div class="mt-3 pt-6 flex flex-col border-t-2">
                        <h3 class="">Sign up for updates</h3>
                        {% include hubspot.script %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include "./common-js.njk" %}

<style>
.line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.related-articles-track {
    will-change: transform;
}

@media (max-width: 768px) {
    .related-articles-prev,
    .related-articles-next {
        display: none;
    }
}
</style>

<script>
(function() {
    const track = document.querySelector('.related-articles-track');
    const prevBtn = document.querySelector('.related-articles-prev');
    const nextBtn = document.querySelector('.related-articles-next');
    
    if (!track || !prevBtn || !nextBtn) return;
    
    const items = track.querySelectorAll('.related-article-item');
    const totalItems = items.length;
    const itemsToShow = window.innerWidth >= 768 ? 3 : 1;
    const itemWidth = 100 / itemsToShow;
    let currentIndex = 0;
    const maxIndex = Math.max(0, Math.ceil(totalItems / itemsToShow) - 1);
    const maxScroll = Math.max(0, totalItems - itemsToShow);
    
    // Auto-slide functionality
    let autoSlideInterval;
    
    function updateSlider() {
        const translateX = -currentIndex * itemWidth;
        track.style.transform = `translateX(${translateX}%)`;
        
        // Update button states
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex >= maxScroll;
        prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
        nextBtn.style.opacity = currentIndex >= maxScroll ? '0.5' : '1';
    }
    
    function slideNext() {
        if (currentIndex < maxScroll) {
            currentIndex = Math.min(currentIndex + 1, maxScroll);
        } else {
            currentIndex = 0; // Loop back to start
        }
        updateSlider();
    }
    
    function slidePrev() {
        if (currentIndex > 0) {
            currentIndex--;
        } else {
            currentIndex = maxScroll; // Loop to end
        }
        updateSlider();
    }
    
    function startAutoSlide() {
        autoSlideInterval = setInterval(slideNext, 5000); // Slide every 5 seconds
    }
    
    function stopAutoSlide() {
        clearInterval(autoSlideInterval);
    }
    
    // Event listeners
    nextBtn.addEventListener('click', () => {
        stopAutoSlide();
        slideNext();
        startAutoSlide();
    });
    
    prevBtn.addEventListener('click', () => {
        stopAutoSlide();
        slidePrev();
        startAutoSlide();
    });
    
    // Pause on hover
    track.addEventListener('mouseenter', stopAutoSlide);
    track.addEventListener('mouseleave', startAutoSlide);
    
    // Handle resize
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            const newItemsToShow = window.innerWidth >= 768 ? 3 : 1;
            const newMaxScroll = Math.max(0, totalItems - newItemsToShow);
            currentIndex = Math.min(currentIndex, newMaxScroll);
            updateSlider();
        }, 250);
    });
    
    // Initialize
    updateSlider();
    startAutoSlide();
})();
</script>


