---
layout: layouts/base.njk
---
{% set hasExamples = integration.examples and integration.examples.length > 0 %}

<!-- Node Details Header -->
<div class="node-header bg-gradient-to-br from-indigo-50 to-white border-b border-gray-200 py-8 min-h-[280px] w-full">
    <div class="container m-auto max-w-6xl px-6 overflow-hidden w-full">
        <div class="flex flex-col md:flex-row gap-6 items-start w-full">
            <div class="flex-grow w-full">
                <div class="flex items-center gap-3 mb-4 flex-wrap">
                    <h1 class="mb-0 text-3xl md:text-4xl font-bold break-words">{{ integration._id }}</h1>
                    {% if integration.ffCertified %}
                    <div class="ff-certified-badge flex items-center gap-2 bg-indigo-100 border-2 border-indigo-600 text-indigo-700 px-4 py-2 rounded-lg font-semibold text-sm whitespace-nowrap flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 2.387a2.99 2.99 0 0 0-3.9 0A2.99 2.99 0 0 0 12 9.75a2.99 2.99 0 0 0 .29 1.28l-.688.687a1.5 1.5 0 0 0 0 2.121l3.536 3.536a1.5 1.5 0 0 0 2.121 0l.687-.688a2.99 2.99 0 0 0 1.28.29 2.99 2.99 0 0 0 3.564-3.21 2.99 2.99 0 0 0-.29-1.28l.688-.687a1.5 1.5 0 0 0 0-2.121l-3.536-3.536a1.5 1.5 0 0 0-2.121 0l-.687.688A2.99 2.99 0 0 0 15.61 6.186Z" clip-rule="evenodd" />
                        </svg>
                        <span>FlowFuse Certified</span>
                    </div>
                    {% endif %}
                </div>
                <p class="text-lg text-gray-700 mb-4 w-full max-w-full break-words">{{ integration.description }}</p>
                <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600">
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
                        </svg>
                        <strong>Version:</strong> {{ integration.version }}
                    </span>
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9.75v6.75m0 0-3-3m3 3 3-3m-8.25 6a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z" />
                        </svg>
                        <strong>Weekly Downloads:</strong> {{ integration.downloads.week | formatNumber }}
                    </span>
                    {% if integration.author %}
                    {% set authorUrl = integration.author.url %}
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                        <strong>Author:</strong>
                        {% if authorUrl and (authorUrl.includes('github.com') or authorUrl.includes('npmjs.com')) %}
                        <a href="{{ authorUrl }}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:text-indigo-800 underline">
                            {{ integration.author.name or integration.author }}
                        </a>
                        {% else %}
                        <span>{{ integration.author.name or integration.author }}</span>
                        {% endif %}
                    </span>
                    {% endif %}
                    {% if integration.lastUpdated %}
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        <strong>Updated:</strong> {{ integration.lastUpdated | shortDate }}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container m-auto max-w-6xl px-6 py-8">
    {% if hasExamples %}
    <!-- Tab Navigation -->
    <div class="border-b border-gray-300 mb-6">
        <nav class="flex gap-8" aria-label="Tabs">
            <button 
                class="tab-button py-3 px-1 border-b-2 border-indigo-600 font-medium text-indigo-600 focus:outline-none"
                data-tab="overview"
            >
                Overview
            </button>
            <button 
                class="tab-button py-3 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none"
                data-tab="examples"
            >
                Examples ({{ integration.examples.length }})
            </button>
        </nav>
    </div>
    {% endif %}

    <div class="prose max-w-none">
        {% if hasExamples %}
        <!-- Overview Tab Content -->
        <div id="overview-content" class="tab-content">
            {{ content | safe }}
        </div>

        <!-- Examples Tab Content -->
        <div id="examples-content" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-4">Example Flows</h2>
            <p class="text-gray-600 mb-6">The following example flows are available for this node.</p>
            
            {% for example in integration.examples %}
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">{{ example.name }}</h3>
                
                {% if example.flow %}
                <div class="bg-white border border-gray-300 rounded overflow-hidden mb-4">
                    <div id="flow-renderer-{{ loop.index0 }}" style="height: 400px;" class="flow-renderer-container"></div>
                </div>
                {% else %}
                <p class="text-gray-500 mb-4">Flow content not available</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        {{ content | safe }}
        {% endif %}
    </div>
</div>

{% if hasExamples %}
<!-- Flow Renderer Script -->
<script type="module">
    import FlowRenderer from '/js/flowrenderer.min.js';

    // Store flow data
    const flowData = [
        {% for example in integration.examples %}
        {% if example.flow %}
        {
            index: {{ loop.index0 }},
            flow: {{ example.flow | safe }}
        }{% if not loop.last %},{% endif %}
        {% endif %}
        {% endfor %}
    ];

    // Add event listeners to tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            switchTab(button.getAttribute('data-tab'));
        });
    });

    // Tab switching function
    function switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            if (button.getAttribute('data-tab') === tabName) {
                button.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                button.classList.add('border-indigo-600', 'text-indigo-600');
            } else {
                button.classList.remove('border-indigo-600', 'text-indigo-600');
                button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            }
        });

        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        document.getElementById(`${tabName}-content`).classList.remove('hidden');

        // Render flows when examples tab is opened
        if (tabName === 'examples') {
            setTimeout(() => renderFlows(), 100);
        }

        // Update URL hash without scrolling
        history.replaceState(null, null, `#${tabName}`);
    }

    // Render flows function
    function renderFlows() {
        const renderer = new FlowRenderer();
        
        flowData.forEach(item => {
            const container = document.getElementById(`flow-renderer-${item.index}`);
            if (container && !container.hasAttribute('data-rendered')) {
                try {
                    renderer.renderFlows(item.flow, {
                        container: container,
                        direction: 'LR',
                        gridLines: true,
                        zoom: true,
                        labels: true,
                        autoZoom: true
                    });
                    container.setAttribute('data-rendered', 'true');
                } catch (error) {
                    console.error('Error rendering flow:', error);
                    container.innerHTML = '<div class="p-4 text-gray-500">Error rendering flow visualization</div>';
                }
            }
        });
    }

    // Handle initial hash on page load
    window.addEventListener('DOMContentLoaded', () => {
        const hash = window.location.hash.slice(1);
        if (hash === 'examples') {
            switchTab('examples');
        }
    });
</script>
{% endif %}
