---
layout: layouts/base.njk
---
{% set hasExamples = integration.examples and integration.examples.length > 0 %}

<!-- Node Details Header -->
<div class="node-header bg-gradient-to-br from-indigo-50 to-white border-b border-gray-200 py-8 min-h-[280px] w-full">
    <div class="container m-auto max-w-6xl px-6 overflow-hidden w-full">
        <div class="flex flex-col md:flex-row gap-6 items-start w-full">
            <div class="flex-grow w-full">
                <div class="flex items-center gap-3 mb-4 flex-wrap">
                    <h1 class="mb-0 text-3xl md:text-4xl font-bold break-words">{{ integration._id }}</h1>
                    {% if integration.ffCertified %}
                    <div class="ff-certified-badge flex items-center gap-2 bg-indigo-100 border-2 border-indigo-600 text-indigo-700 px-4 py-2 rounded-lg font-semibold text-sm whitespace-nowrap flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 2.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
                        </svg>
                        <span>FlowFuse Certified</span>
                    </div>
                    {% endif %}
                </div>
                <p class="text-lg text-gray-700 mb-4 w-full max-w-full break-words">{{ integration.description }}</p>
                <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600">
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
                        </svg>
                        <strong>Version:</strong> {{ integration.version }}
                    </span>
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9.75v6.75m0 0-3-3m3 3 3-3m-8.25 6a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z" />
                        </svg>
                        <strong>Weekly Downloads:</strong> {{ integration.downloads.week | formatNumber }}
                    </span>
                    {% if integration.author %}
                    {% set authorUrl = integration.author.url %}
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                        <strong>Author:</strong>
                        {% if authorUrl and (authorUrl.includes('github.com') or authorUrl.includes('npmjs.com')) %}
                        <a href="{{ authorUrl }}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:text-indigo-800 underline">
                            {{ integration.author.name or integration.author }}
                        </a>
                        {% else %}
                        <span>{{ integration.author.name or integration.author }}</span>
                        {% endif %}
                    </span>
                    {% endif %}
                    {% if integration.lastUpdated %}
                    <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        <strong>Updated:</strong> {{ integration.lastUpdated | shortDate }}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container m-auto max-w-6xl px-6 py-8">
    {% if hasExamples %}
    <!-- Tab Navigation -->
    <div class="border-b border-gray-300 mb-6">
        <nav class="flex gap-8" aria-label="Tabs">
            <button 
                class="tab-button py-3 px-1 border-b-2 border-indigo-600 font-medium text-indigo-600 focus:outline-none"
                data-tab="overview"
                onclick="switchTab('overview')"
            >
                Overview
            </button>
            <button 
                class="tab-button py-3 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none"
                data-tab="examples"
                onclick="switchTab('examples')"
            >
                Examples ({{ integration.examples.length }})
            </button>
        </nav>
    </div>
    {% endif %}

    <div class="flex flex-col lg:flex-row gap-8 min-w-0">
        <!-- Documentation Content -->
        <div class="flex-grow min-w-0 overflow-hidden">
            {% if hasExamples %}
            <!-- Overview Tab Content -->
            <div id="overview-content" class="tab-content">
            {% endif %}
                {% if integration.ffCertified %}
                <div class="mb-8 p-6 bg-indigo-50 border-l-4 border-indigo-600 rounded-r-lg overflow-hidden">
                    <h3 class="text-indigo-900 font-bold mb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 2.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
                        </svg>
                        FlowFuse Certified Node
                    </h3>
                    <p class="text-indigo-800 mb-0">This node has been certified by FlowFuse, ensuring it meets our standards for quality, security, and support. <a href="https://flowfuse.com/blog/2025/07/certified-nodes-v2/" class="font-semibold underline hover:text-indigo-900" target="_blank">Learn more about certified nodes</a>.</p>
                </div>
                {% else %}
                <div class="mb-8 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-r-lg overflow-hidden">
                    <h3 class="text-blue-900 font-bold mb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
                        </svg>
                        Get Your Node Certified
                    </h3>
                    <p class="text-blue-800 mb-3">Boost your node's credibility and reach by becoming FlowFuse Certified. Certification demonstrates quality, security, and reliability to the Node-RED community.</p>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <a href="https://flowfuse.com/blog/2025/07/certified-nodes-v2/#contact-us-to-discuss-your-node-certification" class="ff-btn ff-btn--primary" target="_blank" rel="noopener noreferrer">
                            START CERTIFICATION PROCESS
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                            </svg>
                        </a>
                        <a href="https://flowfuse.com/blog/2025/07/certified-nodes-v2/" class="ff-btn ff-btn--primary-outlined" target="_blank" rel="noopener noreferrer">
                            LEARN MORE
                        </a>
                    </div>
                </div>
                {% endif %}
                
                <!-- Documentation Content -->
                <div class="prose prose-lg prose-indigo max-w-none mb-12 overflow-hidden">
                    {{ integration.readme | md | stripFirstH1 | rewriteIntegrationLinks(integration) | safe }}
                </div>
            {% if hasExamples %}
            </div>

            <!-- Examples Tab Content -->
            <div id="examples-content" class="tab-content hidden">
                <h2 class="text-2xl font-bold mb-4">Example Flows</h2>
                <p class="text-gray-600 mb-6">The following example flows are available for this node. You can copy them and import directly into Node-RED.</p>
                
                {% for example in integration.examples %}
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-2">{{ example.name }}</h3>
                    
                    {% if example.flow %}
                    <div class="bg-white border border-gray-300 rounded p-4 mb-4 overflow-x-auto">
                        <pre class="text-xs m-0"><code>{{ example.flow }}</code></pre>
                    </div>
                    
                    <div class="flex gap-3">
                        <button 
                            onclick="copyFlowToClipboard(this, {{ loop.index0 }})" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors"
                            data-flow="{{ example.flow | replace('\"', '&quot;') | replace('\n', '&#10;') }}"
                        >
                            Copy Flow
                        </button>
                        {% if example.url %}
                        <a 
                            href="{{ example.url }}" 
                            target="_blank" 
                            rel="noopener" 
                            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded text-sm font-medium transition-colors inline-block no-underline"
                        >
                            View on GitHub
                        </a>
                        {% endif %}
                    </div>
                    {% else %}
                    <p class="text-gray-500 mb-4">Flow content not available</p>
                    {% if example.downloadUrl %}
                    <div class="flex gap-3">
                        <a 
                            href="{{ example.downloadUrl }}" 
                            target="_blank" 
                            rel="noopener" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors inline-block no-underline"
                        >
                            Download Flow
                        </a>
                        {% if example.url %}
                        <a 
                            href="{{ example.url }}" 
                            target="_blank" 
                            rel="noopener" 
                            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded text-sm font-medium transition-colors inline-block no-underline"
                        >
                            View on GitHub
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="lg:w-80 flex-shrink-0 min-w-0">
            <div class="space-y-6">
                <!-- Installation -->
                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm overflow-hidden">
                    <h3 class="text-lg font-bold mb-3 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" />
                        </svg>
                        Installation
                    </h3>
                    <p class="text-sm text-gray-600 mb-3">Install via <a href="https://flowfuse.com/node-red/getting-started/library/#using-command-line-(npm)" class="text-indigo-600 hover:text-indigo-800 font-semibold" target="_blank">npm</a> or use the <a href="https://flowfuse.com/node-red/getting-started/library/#using-the-palette-manager" class="text-indigo-600 hover:text-indigo-800 font-semibold" target="_blank">Node-RED palette manager</a>:</p>
                    <div class="bg-gray-900 text-gray-100 p-3 rounded font-mono text-sm overflow-x-auto">
                        <code class="!bg-transparent !border-0 !p-0 text-gray-100 break-all whitespace-pre-wrap">npm install {{ integration._id }}</code>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm overflow-hidden">
                    <h3 class="text-lg font-bold mb-4">Quick Stats</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between items-center pb-2 border-b">
                            <span class="text-gray-600">Current Version</span>
                            <span class="font-semibold">{{ integration.version }}</span>
                        </div>
                        <div class="flex justify-between items-center pb-2 border-b">
                            <span class="text-gray-600">Weekly Downloads</span>
                            <span class="font-semibold">{{ integration.downloads.week | formatNumber }}</span>
                        </div>
                        {% if integration.created %}
                        <div class="flex justify-between items-center pb-2 border-b">
                            <span class="text-gray-600">Published</span>
                            <span class="font-semibold">{{ integration.created | shortDate }}</span>
                        </div>
                        {% endif %}
                        {% if integration.lastUpdated %}
                        <div class="flex justify-between items-center pb-2 border-b">
                            <span class="text-gray-600">Last Updated</span>
                            <span class="font-semibold">{{ integration.lastUpdated | shortDate }}</span>
                        </div>
                        {% endif %}
                        {% if integration.license %}
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">License</span>
                            <span class="font-semibold">{{ integration.license }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- External Links -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 overflow-hidden">
                    <h3 class="text-sm font-semibold mb-3 text-gray-600 uppercase">External Resources</h3>
                    <div class="space-y-2 text-sm">
                        <a href="https://www.npmjs.com/package/{{ integration._id }}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-gray-700 hover:text-indigo-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                            </svg>
                            View on NPM
                        </a>
                        {% if integration.repository and integration.repository.url %}
                        <a href="{{ integration.repository.url | replace('git+', '') | replace('.git', '') }}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-gray-700 hover:text-indigo-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                            </svg>
                            View Repository
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if hasExamples %}
<script>
    function switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            const isActive = button.dataset.tab === tabName;
            if (isActive) {
                button.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                button.classList.add('border-indigo-600', 'text-indigo-600');
            } else {
                button.classList.remove('border-indigo-600', 'text-indigo-600');
                button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            }
        });

        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        document.getElementById(`${tabName}-content`).classList.remove('hidden');

        // Update URL hash without scrolling
        history.replaceState(null, null, `#${tabName}`);
    }

    function copyFlowToClipboard(button, index) {
        const flowText = button.getAttribute('data-flow');
        navigator.clipboard.writeText(flowText).then(() => {
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            button.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
            button.classList.add('bg-green-600', 'hover:bg-green-700');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('bg-green-600', 'hover:bg-green-700');
                button.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy:', err);
            alert('Failed to copy to clipboard');
        });
    }

    // Handle initial hash on page load
    window.addEventListener('DOMContentLoaded', () => {
        const hash = window.location.hash.slice(1);
        if (hash === 'examples') {
            switchTab('examples');
        }
    });
</script>
{% endif %}
